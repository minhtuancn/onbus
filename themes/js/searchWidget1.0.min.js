function closeSelector() {
    $(".place-selector").hide()
}

function searchTickets() {
    if (!$.isNumeric($("#start-point-id").val())) return $("#departPlace").trigger("focus"), !1;
    if (!$.isNumeric($("#stop-point-id").val())) return $("#destination").trigger("focus"), !1;
    var a = $("#departDate").val();
    null != a && (a = a.replace(/\//gi, "-"));
    if (null == a || "" == a) return $("#departDate").trigger("focus"), !1;
    var b = locdau($("#departPlace").val()),
        c = locdau($("#destination").val());
    "ho-chi-minh" == b && (b = "sai-gon");
    "ho-chi-minh" == c && (c = "sai-gon");
    var e = $("#search-busoperator-id").val(),
        f = locdau($("#search-busoperator-name").val()),
        d = "/ve-xe-khach",
        d = 0 < e ? d + ("-" + f + "-tu-" + b + "-di-" + c + "-ngay-" + a + "-") : d + ("-tu-" + b + "-di-" + c + "-ngay-" + a + "-"),
        a = $("#start-point-type").val(),
        b = $("#start-point-id").val(),
        c = $("#stop-point-type").val(),
        f = $("#stop-point-id").val(),
        g = $("#passengerNum").val();
    "" == g && (g = 1);
    "" != a && "" != b && "" != c && "" != f && (d = 0 < e ? d + String.format("{0}{1}t{2}{3}{4}-{5}.html", a, b, c, f, g, e) : d + String.format("{0}{1}t{2}{3}{4}.html", a, b, c, f, g), showLoading(), location.href = "/vi-VN" + d);
    return !1
}

function clickOutsideSelector(a) {
    $(document).mouseup(function(b) {
        var c = $(a),
            e = c.prev();
        !c.is(":visible") || e.is(":focus") || c.is(b.target) || 0 !== c.has(b.target).length || c.hide()
    })
}

function maskEventOnDepartureInput() {
    $("#departPlace").focus(function() {
        closeSelector();
        //$(this).next("#departPlaceSelector").css("display", "block")
    });
    $("#departPlace").keypress(function(a) {
        //alert(a.keyCode);
        13 == a.keyCode ? $(this).val() ? $("#destination").focus() : $(this).focus() : closeSelector()
    });
    $("#departPlace").catcomplete({
        autoFocus: !0,
        delay: 0,
        source: function(a, b) {
            var c = slug(a.term);
            b($.map(statecity, function(a) {
                var b = slug(a.label);
                if ("Qu\u1eadn - Huy\u1ec7n" == a.Category && 0 === b.split("qwerty")[1].toString().indexOf(c) ||
                    0 === b.indexOf(c)) return a
            }))
        },
        select: function(a, b) {
            $("#departPlace").val(b.item.label);
            0 < b.item.CityId ? ($("#start-point-type").val(2), $("#start-point-id").val(b.item.CityId)) : ($("#start-point-type").val(1), $("#start-point-id").val(b.item.StateId));
            $("#search-busoperator-id").val("");
            $("#search-busoperator-name").val("");
            $("#destination").focus();
            return !1
        }
    })
}

function maskEventOnDestinationInput() {
    $("#destination").focus(function() {
        closeSelector();
        //$(this).next("#destinationSelector").css("display", "block")
    });
    $("#destination").keypress(function(a) {
        13 == a.keyCode ? $(this).val() ? $("#departDate").focus() : $(this).focus() : closeSelector()
    });
    $("#destination").catcomplete({
        autoFocus: !0,
        delay: 0,
        source: function(a, b) {
            var c = slug(a.term);
            b($.map(statecity, function(a) {
                var b = slug(a.label);
                if ("Qu\u1eadn - Huy\u1ec7n" == a.Category && 0 === b.split("qwerty")[1].toString().indexOf(c) ||
                    0 === b.indexOf(c)) return a
            }))
        },
        select: function(a, b) {
            $("#destination").val(b.item.label);
            0 < b.item.CityId ? ($("#stop-point-type").val(2), $("#stop-point-id").val(b.item.CityId)) : ($("#stop-point-type").val(1), $("#stop-point-id").val(b.item.StateId));
            $("#search-busoperator-id").val("");
            $("#search-busoperator-name").val("");
            $("#departDate").focus();
            return !1
        }
    })
}

function maskEventOnDepartTimeInput() {
    $("#departDate").datepicker({
        minDate: new Date,
        numberOfMonths: 2,
        onSelect: function() {
            var a = Math.abs(new Date - $(this).datepicker("getDate")),
                a = Math.round(a / 864E5);
            $(this).datepicker("getDate") > $("#returnDate").datepicker("getDate") && $("#returnDate").datepicker("option", "minDate", a + 1)
        }
    });
    $("#departDate").focus(function() {
        closeSelector()
    })
}

function maskEventOnDestinationTimeInput() {
    $("#returnDate").datepicker({
        minDate: new Date,
        numberOfMonths: 2
    });
    $("#returnDate").focus(function() {
        closeSelector()
    })
}

function maskEventOnNumTicketSelect() {
    $("#passengerNum").customSelect()
}

function maskEventOnSelectStatePopup() {
    $("li.city > a").click(function() {
        var a = $(this).parent().parent().parent().parent().parent(),
            b = $(this).attr("data-state");
        "departPlaceSelector" == a.attr("id") ? ($("#departPlace").val($(this).text()), $("#start-point-type").val(1), $("#start-point-id").val(b), $("#search-busoperator-id").val(""), $("#search-busoperator-name").val(""), $("#destination").focus()) : "destinationSelector" == a.attr("id") && ($("#destination").val($(this).text()), $("#stop-point-type").val(1), $("#stop-point-id").val(b),
            $("#search-busoperator-id").val(""), $("#search-busoperator-name").val(""), $("#departDate").focus());
        return !1
    });
    $("a.close").click(function() {
        closeSelector()
    });
    clickOutsideSelector("#departPlaceSelector");
    clickOutsideSelector("#destinationSelector")
}

function trackingGoogleAnalytics() {
    ga("send", "event", "button", "click", "Search Ticket")
}

function maskEventOnSearchButton() {
    $("#searchSubmit").click(function() {
        trackingGoogleAnalytics();
        searchTickets()
    });
    $("#searchSubmit").keypress(function(a) {
        13 == a.keyCode && searchTickets()
    })
}

function initSearchTicketWidget() {
    maskEventOnDepartureInput();
    maskEventOnDestinationInput();
    maskEventOnDepartTimeInput();
    maskEventOnDestinationTimeInput();
    maskEventOnNumTicketSelect();
    maskEventOnSelectStatePopup();
    maskEventOnSearchButton()
};